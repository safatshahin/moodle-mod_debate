/**
 * Js for debate page.
 *
 * @package     mod_debate
 * @copyright   2021 Safat Shahin <safatshahin@yahoo.com>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_debate/debate_view",["jquery","core/ajax","core/str","core/config","core/notification","core/templates"],(function($,AJAX,str,mdlcfg,notification,templates){var debateView={init:function(userFullName,userImageURL,userID,courseID,debateID,userCapability,userEditCapability,userDeleteCapability){var timer,responseType=0,responseId="",responseTextID="",id=0,elementid="",elementidContainer="",editID="",deleteID="",delay=(timer=0,function(callback,ms){clearTimeout(timer),timer=setTimeout(callback,ms)});$.animateToDiv=function(){$("html, body").animate({scrollTop:$(".mod-debate-topic-container").offset().top},2e3)},$(".mod-debate-response-input").keyup((function(){delay((function(){$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container");var userResponsetext=$(responseTextID).val();userResponsetext.length>0&&toxicity.load(.9).then((model=>{model.classify(userResponsetext).then((predictions=>{AJAX.call([{methodname:"mod_debate_find_debate_respose",args:{courseid:parseInt(courseID),debateid:parseInt(debateID),response:userResponsetext,responsetype:parseInt(responseType),sentiment:JSON.stringify(predictions)}}])[0].done((function(found){if(found.result){var getResponses=JSON.parse(found.data),sentimentContext={found_sentiment:JSON.parse(found.sentiment)},context={found_response:getResponses};($("#mod-debate-insert-postive-response").is(":visible")||$("#mod-debate-insert-negative-response").is(":visible"))&&(templates.render("mod_debate/debate_find_response",context).then((function(html,js){$(responseId).after(html)})).fail(notification.exception),templates.render("mod_debate/debate_sentiment",sentimentContext).then((function(html,js){$(responseId).after(html)})).fail(notification.exception))}})).fail(notification.exception)}))}))}),700)})),$(document).on("click",".mod-debate-negative-delete",(function(){id=$(this).attr("data-id"),debateView.deleteResponse(courseID,debateID,id)})),$(document).on("click",".mod-debate-positive-delete",(function(){id=$(this).attr("data-id"),debateView.deleteResponse(courseID,debateID,id)})),$(document).on("click",".mod-debate-negative-edit",(function(){if(id=$(this).attr("data-id"),elementid="#element"+id,elementidContainer="#element"+id+"container",$("#mod-debate-insert-postive-response").is(":hidden")&&$("#mod-debate-insert-negative-response").is(":hidden")){var text=$(elementid).text().trim();responseType=0,responseId="#mod-debate-insert-negative-response",editID="mod-debate-negative-edit",deleteID="mod-debate-negative-delete",$(responseTextID="#mod-debate-negative-response-input").val(text),$(responseTextID).html(text),$(elementidContainer).css("display","none"),$(responseId).css("display","block"),$.animateToDiv()}else debateView.renderNotification(0,"info")})),$(document).on("click",".mod-debate-positive-edit",(function(){if(id=$(this).attr("data-id"),elementid="#element"+id,elementidContainer="#element"+id+"container",$("#mod-debate-insert-negative-response").is(":hidden")&&$("#mod-debate-insert-postive-response").is(":hidden")){var text=$(elementid).text().trim();responseType=1,responseId="#mod-debate-insert-postive-response",editID="mod-debate-positive-edit",deleteID="mod-debate-positive-delete",$(responseTextID="#mod-debate-positive-response-input").val(text),$(responseTextID).html(text),$(elementidContainer).css("display","none"),$(responseId).css("display","block"),$.animateToDiv()}else debateView.renderNotification(0,"info")})),$(document).on("click",".mod-debate-positive-icon",(function(){$("#mod-debate-insert-negative-response").is(":hidden")&&$("#mod-debate-insert-postive-response").is(":hidden")?AJAX.call([{methodname:"mod_debate_check_response_allocation",args:{debateid:parseInt(debateID),attribute:"positive",userid:parseInt(userID)}}])[0].done((function(output){output.result?(responseType=1,responseId="#mod-debate-insert-postive-response",editID="mod-debate-positive-edit",deleteID="mod-debate-positive-delete",$(responseTextID="#mod-debate-positive-response-input").val(""),$(responseId).css("display","block"),id=0):notification.addNotification({message:output.message,type:"info"})})).fail(notification.exception):debateView.renderNotification(0,"info")})),$(document).on("click",".mod-debate-negative-icon",(function(){$("#mod-debate-insert-postive-response").is(":hidden")&&$("#mod-debate-insert-negative-response").is(":hidden")?AJAX.call([{methodname:"mod_debate_check_response_allocation",args:{debateid:parseInt(debateID),attribute:"negative",userid:parseInt(userID)}}])[0].done((function(output){output.result?(responseType=0,responseId="#mod-debate-insert-negative-response",editID="mod-debate-negative-edit",deleteID="mod-debate-negative-delete",$(responseTextID="#mod-debate-negative-response-input").val(""),$(responseId).css("display","block"),id=0):notification.addNotification({message:output.message,type:"info"})})).fail(notification.exception):debateView.renderNotification(0,"info")})),$(document).on("click","#mod-debate-cancel-respose",(function(){$(responseId).css("display","none"),$(elementidContainer).css("display","block"),$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container")})),$(document).on("click","#mod-debate-update-response",(function(){$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container");var userResponse=$(responseTextID).val();userResponse.length>0?AJAX.call([{methodname:"mod_debate_add_debate_respose",args:{courseid:parseInt(courseID),debateid:parseInt(debateID),response:userResponse,responsetype:parseInt(responseType),id:parseInt(id)}}])[0].done((function(output){if(output.result){$(responseId).css("display","none"),$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container"),$(elementidContainer).remove(),0===id&&$.isNumeric(output.id)&&(id=output.id);var outputContext={user_profile_image:userImageURL,user_full_name:userFullName,response:userResponse,elementidcontainer:"element"+id+"container",elementid:"element"+id,user_capability:userCapability,user_edit_capability:userEditCapability,user_delete_capability:userDeleteCapability,id:id,editid:editID,deleteid:deleteID};templates.render("mod_debate/debate_response_output",outputContext).then((function(html,js){$(responseId).after(html),id=0,$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container"),elementidContainer="",elementid=""})).fail(notification.exception)}else debateView.renderNotification(2,"error");$("div").remove(".mod-debate-find-response"),$("div").remove(".mod-debate-sentiment-container")})).fail(notification.exception):debateView.renderNotification(1,"info")}))},deleteResponse:function(courseID,debateID,id){str.get_strings([{key:"confirm_delete",component:"mod_debate"}]).done((function(s){if(confirm(s[0])){var elementidContainer="#element"+id+"container";AJAX.call([{methodname:"mod_debate_delete_debate_respose",args:{courseid:parseInt(courseID),debateid:parseInt(debateID),id:parseInt(id)}}])[0].done((function(deleted){deleted.result?($(elementidContainer).remove(),debateView.renderNotification(4,"info")):debateView.renderNotification(3,"info")})).fail(notification.exception)}}))},renderNotification:function(notificationValue,notificationType){str.get_strings([{key:"edit_mode_active",component:"mod_debate"},{key:"empty_response",component:"mod_debate"},{key:"error_add",component:"mod_debate"},{key:"error_delete",component:"mod_debate"},{key:"success_delete",component:"mod_debate"}]).then((function(results){notification.addNotification({message:results[notificationValue],type:notificationType})}))}};return debateView}));

//# sourceMappingURL=debate_view.min.js.map